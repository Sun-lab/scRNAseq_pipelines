cluster_tag_seq=1:17
file_tag="3k10"
###########functions#############
setwd("/Volumes/SpecialPass/fh_data/Data_PRJNA434002/")
#input phenotype
if(is.na(unlist(strsplit(file_tag,"k"))[2])){
tmeta=meta=read.table("../Data_PRJNA434002/meta.tsv",header = TRUE, sep = "\t")
}
if(!is.na(unlist(strsplit(file_tag,"k"))[2])){
tmeta=readRDS(paste0("../Data_PRJNA434002/meta",unlist(strsplit(file_tag,"k"))[2],".rds"))
}
total_individual=unique(tmeta$individual)
48919/2
eval(parse("PFC_L2_3"))
cell_info=readRDS("meta10.rds")
iInfo = distinct(cell_info[,3:12])
set.seed(101)
N<-500; J<-5000 #number of cells and genes
sz<-rgamma(N,shape=10,rate=10)
summary(sz)
mu1<-.1; mu2<-5; mu3a<-1; mu3b<-9
Y1<-replicate(J/2,rnbinom(N,size=.1,mu=mu1*sz))
Y2<-replicate(J/4,rpois(N,mu2*sz))
Y3a<-replicate(J/4,rnbinom(N/2,size=.1,mu=mu3a*sz[1:(N/2)]))
Y3b<-replicate(J/4,rnbinom(N/2,size=.1,mu=mu3b*sz[((N/2)+1):N]))
Y3<-rbind(Y3a,Y3b)
Y<-t(cbind(Y1,Y2,Y3))
summary(colSums(Y))
summary(1-colMeans(Y>0))
max(Y)
gtype<-c(rep("low",J/2),rep(c("high_const","high_var"),each=J/4))
rm<-rowMeans(Y)
summary(rm)
boxplot(rm~gtype) #ensure high_var and high_const have same row means
gm<-data.frame(gtype=gtype)
cm<-data.frame(celltype=rep(c("a","b"),each=N/2),nUMI=colSums(Y))
View(Y)
?lsfit
install.packages("shiny")
library(shiny)
runExample("01_hello")
library(shiny)
runApp("my_app")
library(shiny)
# Define UI ----
ui <- fluidPage(
)
# Define server logic ----
server <- function(input, output) {
}
# Run the app ----
shinyApp(ui = ui, server = server)
a=diag(100000)
a=diag(1000)
a=diag(1000)
theta0=3
theta1=5
g=2
ng=rep(1000,g)
N=sum(ng)
ig=1
a=diag(1000)
theta0=3
theta1=5
g=2
ng=rep(1000,g)
N=sum(ng)
Xi=c(0.5,0.5) #length g
pi=c(0.9,0.2)
curS=theta0+ sqrt(1-Xi[ig])*rnorm(ng[ig],0,1)-sqrt(Xi[ig])*rnorm(ng[ig],0,1)
hist(curS)
plot(1:ng[ig])
plot(1:ng[ig],curS)
Z0=sqrt(Xi[ig])*rnorm(n,0,1)
for(ig in 1:g){
Zg=rnorm(n,0,1)
curS=theta0+ sqrt(1-Xi[ig])*Zg-sqrt(Xi[ig])*Z0
alt_n=round(pi[ig]*ng[ig])
curS[1:alt_n]=curS[1:alt_n]+theta1-theta0
}
a=diag(1000)
theta0=3
theta1=5
g=2
n=1000
ng=rep(n,g)
N=sum(ng)
Xi=c(0.5,0.5) #length g
pi=c(0.9,0.2)
Z0=sqrt(Xi[ig])*rnorm(n,0,1)
Zg=rnorm(n,0,1)
curS=theta0+ sqrt(1-Xi[ig])*Zg-sqrt(Xi[ig])*Z0
alt_n=round(pi[ig]*ng[ig])
curS[1:alt_n]=curS[1:alt_n]+theta1-theta0
plot(1:ng[ig],curS)
a=diag(1000)
theta0=3
theta1=5
g=2
n=1000
ng=rep(n,g)
N=sum(ng)
Xi=c(0.5,0.5) #length g
pi=c(0.9,0.2)
Z0=sqrt(Xi[ig])*rnorm(n,0,1)
S=matrix(ncol=g,nrow=n)
for(ig in 1:g){
Zg=rnorm(n,0,1)
S=[,ig]theta0+ sqrt(1-Xi[ig])*Zg-sqrt(Xi[ig])*Z0
alt_n=round(pi[ig]*n)
S[1:alt_n,ig]=S[1:alt_n,ig]+theta1-theta0
}
a=diag(1000)
theta0=3
theta1=5
g=2
n=1000
ng=rep(n,g)
N=sum(ng)
Xi=c(0.5,0.5) #length g
pi=c(0.9,0.2)
Z0=sqrt(Xi[ig])*rnorm(n,0,1)
S=matrix(ncol=g,nrow=n)
a=diag(1000)
theta0=3
theta1=5
g=2
n=1000
ng=rep(n,g)
N=sum(ng)
Xi=c(0.5,0.5) #length g
pi=c(0.9,0.2)
Z0=sqrt(Xi[ig])*rnorm(n,0,1)
S=matrix(ncol=g,nrow=n)
Zg=rnorm(n,0,1)
S[,ig]=theta0+ sqrt(1-Xi[ig])*Zg-sqrt(Xi[ig])*Z0
ig=1
S[,ig]=theta0+ sqrt(1-Xi[ig])*Zg-sqrt(Xi[ig])*Z0
alt_n=round(pi[ig]*n)
S[1:alt_n,ig]=S[1:alt_n,ig]+theta1-theta0
Z0=sqrt(Xi[ig])*rnorm(n,0,1)
S=matrix(ncol=g,nrow=n)
for(ig in 1:g){
Zg=rnorm(n,0,1)
S[,ig]=theta0+ sqrt(1-Xi[ig])*Zg-sqrt(Xi[ig])*Z0
alt_n=round(pi[ig]*n)
S[1:alt_n,ig]=S[1:alt_n,ig]+theta1-theta0
}
plot(S[,1],S[,2])
cor(S[,1],S[,2])
sqrt(1-theta)
sqrt(1-Xi[1])
sqrt(Xi[1])
sqrt(1-Xi[1])
a=diag(1000)
theta0=3
theta1=3
g=2
n=1000
ng=rep(n,g)
N=sum(ng)
Xi=c(0.5,0.5) #length g
pi=c(0.9,0.2)
Z0=sqrt(Xi[ig])*rnorm(n,0,1)
S=matrix(ncol=g,nrow=n)
for(ig in 1:g){
Zg=rnorm(n,0,1)
S[,ig]=theta0+ sqrt(1-Xi[ig])*Zg-sqrt(Xi[ig])*Z0
alt_n=round(pi[ig]*n)
S[1:alt_n,ig]=S[1:alt_n,ig]+theta1-theta0
}
plot(S[,1],S[,2])
cor(S[,1],S[,2])
a=diag(1000)
theta0=3
theta1=5
g=2
n=1000
ng=rep(n,g)
N=sum(ng)
Xi=c(0.5,0.5) #length g
pi=c(0.9,0.2)
Z0=sqrt(Xi[ig])*rnorm(n,0,1)
S=matrix(ncol=g,nrow=n)
for(ig in 1:g){
Zg=rnorm(n,0,1)
S[,ig]=theta0+ sqrt(1-Xi[ig])*Zg-sqrt(Xi[ig])*Z0
alt_n=round(pi[ig]*n)
S[1:alt_n,ig]=S[1:alt_n,ig]+theta1-theta0
}
plot(S[,1],S[,2])
cor(S[,1],S[,2])
theta0=3
theta1=5
g=2
n=100000
ng=rep(n,g)
N=sum(ng)
Xi=c(0.5,0.5) #length g
pi=c(0.9,0.2)
Z0=sqrt(Xi[ig])*rnorm(n,0,1)
S=matrix(ncol=g,nrow=n)
for(ig in 1:g){
Zg=rnorm(n,0,1)
S[,ig]=theta0+ sqrt(1-Xi[ig])*Zg-sqrt(Xi[ig])*Z0
alt_n=round(pi[ig]*n)
S[1:alt_n,ig]=S[1:alt_n,ig]+theta1-theta0
}
plot(S[,1],S[,2])
cor(S[,1],S[,2])
a=diag(1000)
theta0=3
theta1=5
g=2
n=100000
ng=rep(n,g)
N=sum(ng)
Xi=c(0.8,0.8) #length g
pi=c(0.9,0.2)
Z0=sqrt(Xi[ig])*rnorm(n,0,1)
S=matrix(ncol=g,nrow=n)
for(ig in 1:g){
Zg=rnorm(n,0,1)
S[,ig]=theta0+ sqrt(1-Xi[ig])*Zg-sqrt(Xi[ig])*Z0
alt_n=round(pi[ig]*n)
S[1:alt_n,ig]=S[1:alt_n,ig]+theta1-theta0
}
plot(S[,1],S[,2])
cor(S[,1],S[,2])
a=diag(1000)
theta0=3
theta1=5
g=2
n=100000
ng=rep(n,g)
N=sum(ng)
Xi=c(0.8,0.8) #length g
pi=c(0.9,0.2)
Z0=sqrt(Xi[ig])*rnorm(n,0,1)
S=matrix(ncol=g,nrow=n)
for(ig in 1:g){
Zg=rnorm(n,0,1)
S[,ig]=theta0+ sqrt(1-Xi[ig])*Zg-sqrt(Xi[ig])*Z0[1]
alt_n=round(pi[ig]*n)
S[1:alt_n,ig]=S[1:alt_n,ig]+theta1-theta0
}
plot(S[,1],S[,2])
cor(S[,1],S[,2])
cov(S[,1],S[,2])
cov(S[,1],S[,2])
set.seed(7)
a=diag(1000)
theta0=3
theta1=5
g=2
n=100000
ng=rep(n,g)
N=sum(ng)
Xi=c(0.8,0.8) #length g
pi=c(0.9,0.2)
Z0=sqrt(Xi[ig])*rnorm(n,0,1)
S=matrix(ncol=g,nrow=n)
for(ig in 1:g){
Zg=rnorm(n,0,1)
S[,ig]=theta0+ sqrt(1-Xi[ig])*Zg-sqrt(Xi[ig])*Z0[1]
alt_n=round(pi[ig]*n)
S[1:alt_n,ig]=S[1:alt_n,ig]+theta1-theta0
}
plot(S[,1],S[,2])
cov(S[,1],S[,2])
set.seed(7)
a=diag(1000)
theta0=3
theta1=5
g=2
n=100000
ng=rep(n,g)
N=sum(ng)
Xi=c(0.8,0.8) #length g
pi=c(0.9,0.2)
Z0=sqrt(Xi[ig])*rnorm(n,0,1)
S=matrix(ncol=g,nrow=n)
for(ig in 1:g){
Zg=rnorm(n,0,1)
S[,ig]=theta0+ sqrt(1-Xi[ig])*Zg-sqrt(Xi[ig])*Z0[1]
alt_n=round(pi[ig]*n)
S[1:alt_n,ig]=S[1:alt_n,ig]+theta1-theta0
}
plot(S[,1],S[,2])
cov(S[,1],S[,2])
set.seed(7)
a=diag(1000)
theta0=3
theta1=5
g=2
n=100000
ng=rep(n,g)
N=sum(ng)
Xi=c(0.8,0.8) #length g
pi=c(0.9,0.2)
Z0=rnorm(n,0,1)
S=matrix(ncol=g,nrow=n)
for(ig in 1:g){
Zg=rnorm(n,0,1)
S[,ig]=theta0+ sqrt(1-Xi[ig])*Zg-sqrt(Xi[ig])*Z0[1]
alt_n=round(pi[ig]*n)
S[1:alt_n,ig]=S[1:alt_n,ig]+theta1-theta0
}
plot(S[,1],S[,2])
cov(S[,1],S[,2])
set.seed(7)
a=diag(1000)
theta0=3
theta1=5
g=2
n=100000
ng=rep(n,g)
N=sum(ng)
Xi=c(0.8,0.8) #length g
pi=c(0.9,0.2)
Z0=rnorm(n,0,1)
S=matrix(ncol=g,nrow=n)
for(ig in 1:g){
Zg=rnorm(n,0,1)
S[,ig]=theta0+ sqrt(1-Xi[ig])*Zg-sqrt(Xi[ig])*Z0
alt_n=round(pi[ig]*n)
S[1:alt_n,ig]=S[1:alt_n,ig]+theta1-theta0
}
plot(S[,1],S[,2])
cov(S[,1],S[,2])
pi0=ng*pi/N
pi0=sum(ng*pi)/N
pi0=sum(ng*pi)/N
alpha_w=alpha/(1-pi0)
alpha=0.05
alpha_w=alpha/(1-pi0)
